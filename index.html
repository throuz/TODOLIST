<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        h1 {
            display: inline;
        }
    </style>
</head>

<body>
    <input id="push_input" type="text">
    <button id="add_button">ADD</button>
    <section id="contents"></section>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-analytics.js"></script>

    <!-- Add the entire Firebase JavaScript SDK -->
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase.js"></script>

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyART1v3wDFXbS4uJFQnKMtPat_D8KiGl9w",
            authDomain: "todolist-test-3acd2.firebaseapp.com",
            databaseURL: "https://todolist-test-3acd2.firebaseio.com",
            projectId: "todolist-test-3acd2",
            storageBucket: "todolist-test-3acd2.appspot.com",
            messagingSenderId: "671710777382",
            appId: "1:671710777382:web:326576d9674136c30cd6e7",
            measurementId: "G-3XL6X52J4G"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        // database
        var db = firebase.database();

        // Add
        let db_push = () => {
            let push_value = document.querySelector("#push_input")
            if (push_value.value != '') {
                db.ref("/todolist").push(push_value.value)
                push_value.value = ''
            } else {
                alert('ADD Input can not be empty!')
            }
        }
        let add_button = document.querySelector('#add_button')
        add_button.addEventListener('click', db_push)

        // Data listed
        db.ref("/todolist").on('value', function (snapshot) {
            let data = snapshot.val();
            let task = Object.values(data)

            // HTML Update
            document.querySelector('#contents').innerHTML = ''
            task.forEach((element) => {
                document.querySelector('#contents').innerHTML += `
                    <div class="task">
                        <h1>${element}</h1>
                        <button class="del_button">DELETE</button>
                        <input class="update_input" type="text" placeholder="Input update data">
                        <button class="update_button">UPDATE</button>
                    </div>
                `
            });

            // Delete
            let delete_button = document.querySelectorAll('.del_button')
            for (let index = 0; index < delete_button.length; index++) {
                delete_button[index].addEventListener('click', () => {
                    let task_key = Object.keys(data)
                    db.ref("/todolist").child(task_key[index]).remove()
                })
            }

            // Update
            let update_button = document.querySelectorAll('.update_button')
            let update_input = document.querySelectorAll('.update_input')
            for (let index = 0; index < delete_button.length; index++) {
                update_button[index].addEventListener('click', () => {
                    let task_key = Object.keys(data)
                    let key = task_key[index].toString()
                    let value = update_input[index].value

                    let obj = {};
                    obj[key] = value;

                    if (value != '') {
                        db.ref("/todolist").update(obj)
                    } else {
                        alert('UPDATE Input can not be empty!')
                    }
                })
            }
        });

    </script>
</body>

</html>